name: "lib.detector.run_script"

on:
  workflow_call:
    inputs:
      title:
        required: false
        type: string
        default: "Detector run"
      command:
        required: true
        type: string
      shell:
        required: false
        type: string
        default: "bash"
  # Defensive: this workflow should be reusable-only, but if it is ever evaluated on push
  # (miswiring / required-check config), keep it green and cheap rather than failing with
  # "workflow file issue" due to missing workflow_call inputs.
  push:
    branches: [main]

permissions:
  contents: read

jobs:
  noop_push:
    if: github.event_name == 'push'
    name: "Reusable workflow (noop on push)"
    runs-on: ubuntu-latest
    steps:
      - name: No-op
        shell: bash
        run: |
          set -euo pipefail
          echo "lib.detector.run_script is reusable (workflow_call)."
          echo "This run is a no-op on push."

  run:
    if: github.event_name == 'workflow_call'
    name: "Detector run"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - name: Run
        shell: bash
        run: ${{ inputs.command }}

      - name: Summary
        if: always()
        run: |
          {
            echo "### Detector summary"
            echo ""
            echo "- **Title**: \`${{ inputs.title }}\`"
            echo "- **Command**: \`${{ inputs.command }}\`"
            echo "- **Result**: ${{ job.status }}"
          } >> "$GITHUB_STEP_SUMMARY"

